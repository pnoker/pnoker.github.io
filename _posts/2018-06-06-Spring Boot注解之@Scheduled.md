---
layout: post
title: Spring Boot注解之@Scheduled
date: 2018-06-06
tag: Spring注解系列
---

### 说明

Spring Boot 的定时任务有两种情况，分别是：
1.指定何时执行任务
2.指定多长时间后执行任务
 
### 修改启动
 
在入口函数上添加 `@EnableScheduling` 注解
 
### 编写定时任务类
 
需要在定时任务的类上加上注释`@Component`,在具体的定时任务方法上加上注释`@Scheduled`即可启动该定时任务
 
### 含义

1.@Scheduled(fixedRate=3000)
 
```text
初始化时生效，以上一个任务的开始时间点为标准，下一个3秒周期执行
```
 
2.@Scheduled(fixedDelay=3000)
 
```text
初始化时生效，以上一个任务的结束时间点为标准，下一个3秒周期执行
```

3.@Scheduled(initialDelay=1000, fixedDelay=3000)

```text
initialDelay需要配合fixedRate或者fixedDelay使用，第一次延时1秒，之后同上规律周期执行
```

4.@Scheduled(cron="* * * * * ?")

```text
按`cron`规则执行，Cron表达式由6或7个由空格分隔的时间字段组成，如表所示：
```
  
| 时间域名         | 允许值           | 允许的特殊字符  |
| -------------  |  :-------------: | ------------ |
| 秒              | 0-59             | , - * /     |
| 分              | 0-59             | , - * /     |
| 时              | 0-23             | , - * /     |
| 日              | 1-31             | , - * ? / L W C|
| 月              | 1-12             | , - * /     |
| 星期            | 1-7              | , - * ? / L C # |
| 年              | 1970-2099        | , - * /     |
    
```text
Cron表达式对特殊字符的大小写不敏感，对代表星期的缩写英文大小写也不敏感。
Cron表达式的时间字段除允许设置数值外，还可使用一些特殊的字符，提供列表、范围、通配符等功能，细说如下：
```
 > * 星号(*)：可用在所有字段中，表示对应时间域的每一个时刻，例如，*在分钟字段时，表示“每分钟”；
 > * 问号（?）：该字符只在日期和星期字段中使用，它通常指定为“无意义的值”，相当于点位符；
 > * 减号(-)：表达一个范围，如在小时字段中使用“10-12”，则表示从10到12点，即10,11,12；
 > * 逗号(,)：表达一个列表值，如在星期字段中使用“MON,WED,FRI”，则表示星期一，星期三和星期五；
 > * 斜杠(/)：x/y表达一个等步长序列，x为起始值，y为增量步长值。如在分钟字段中使用0/15，则表示为0,15,30和45秒，而5/15在分钟字段中表示5,20,35,50，你也可以使用*/y，它等同于0/y；
 > * L：该字符只在日期和星期字段中使用，代表“Last”的意思，但它在两个字段中意思不同。L在日期字段中，表示这个月份的最后一天，如一月的31号，非闰年二月的28号；如果L用在星期中，则表示星期六，等同于7。但是，如果L出现在星期字段里，而且在前面有一个数值X，则表示“这个月的最后X天”，例如，6L表示该月的最后星期五；
 > * W：该字符只能出现在日期字段里，是对前导日期的修饰，表示离该日期最近的工作日。例如15W表示离该月15号最近的工作日，如果该月15号是星期六，则匹配14号星期五；如果15日是星期日，则匹配16号星期一；如果15号是星期二，那结果就是15号星期二。但必须注意关联的匹配日期不能够跨月，如你指定1W，如果1号是星期六，结果匹配的是3号星期一，而非上个月最后的那天。W字符串只能指定单一日期，而不能指定日期范围；
 > * LW组合：在日期字段可以组合使用LW，它的意思是当月的最后一个工作日；
 > * 井号(#)：该字符只能在星期字段中使用，表示当月某个工作日。如6#3表示当月的第三个星期五(6表示星期五，#3表示当前的第三个)，而4#5表示当月的第五个星期三，假设当月没有第五个星期三，忽略不触发；
 > * C：该字符只在日期和星期字段中使用，代表“Calendar”的意思。它的意思是计划所关联的日期，如果日期没有被关联，则相当于日历中所有日期。例如5C在日期字段中就相当于日历5日以后的第一天。1C在星期字段中相当于星期日后的第一天。

### 对比 fixedRate 和 fixedDelay区别

```text
Public abstract long fixedRate
Execute the annotated method with a fixed period in milliseconds between invocations.
```

```text
Public abstract long fixedDelay 
Execute the annotated method with a fixed period in milliseconds between the end of the last invocation and the start of the next.
```

**只是说是 `fixedRate` 任务两次执行时间间隔是任务的开始点，而 `fixedDelay` 的间隔是前次任务的结束与下次任务的开始。**